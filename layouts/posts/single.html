{{ define "main" }}
  <!-- 外層容器 -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- 頁首與導覽列 -->
    <header class="flex justify-between items-center py-6 border-b" style="border-color: var(--border-color);">
      <a href="{{ "/" | relURL }}" class="text-xl sm:text-2xl font-bold" style="color: var(--text-color);">{{ .Site.Title }}</a>
      <nav class="flex items-center space-x-4">
        <a href="{{ "/about/" | relURL }}" class="text-sm sm:text-base hidden sm:block" style="color: var(--text-secondary);">關於我</a>
        <a href="{{ "/posts/" | relURL }}" class="text-sm sm:text-base hidden sm:block" style="color: var(--text-secondary);">封存</a>
        <!-- 深淺主題切換按鈕 -->
        <button id="theme-toggle" title="切換深色/淺色主題">
          <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
          <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
      </nav>
    </header>

    <!-- 文章內容與目錄佈局 -->
    <div class="flex justify-center gap-8 lg:gap-12 py-8 sm:py-12">
      <main class="w-full max-w-4xl prose">
        <!-- 文章標題與標籤 -->
        <header class="mb-8">
          <h1 class="text-3xl sm:text-5xl font-bold tracking-tight mb-4 !mt-0">{{ if .Params.heading }}{{ .Params.heading }}{{ else }}{{ .Title }}{{ end }}</h1>
          <p class="text-base" style="color: var(--text-secondary);">
            發布於 {{ .Date.Format "2006年1月2日" }} ·
            <span class="inline-flex space-x-2">
              {{ range .Params.tags }}
                <span class="text-xs font-semibold bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-200">{{ . }}</span>
              {{ end }}
            </span>
          </p>
        </header>

        <!-- 文章主要內容 -->
        {{ .Content }}

        <!-- 上下篇連結 -->
        <div class="pagination">
          {{ if .PrevInSection }}
            <a href="{{ .PrevInSection.Permalink }}">&laquo; {{ .PrevInSection.Title }}</a>
          {{ end }}
          {{ if .NextInSection }}
            <a href="{{ .NextInSection.Permalink }}">{{ .NextInSection.Title }} &raquo;</a>
          {{ end }}
        </div>

        <!-- 分類與標籤區塊 -->
        <div class="post-taxonomies">
          {{- with .Params.categories }}
          <div class="post-categories">
            <strong>分類:</strong>
            {{ range . }}
              <a href="{{ "categories/" | relURL }}{{ . | urlize }}/">{{ . }}</a>
            {{ end }}
          </div>
          {{- end }}

          {{- with .Params.tags }}
          <div class="post-tags">
            <strong>標籤:</strong>
            {{ range . }}
              <a href="{{ "tags/" | relURL }}{{ . | urlize }}/">#{{ . }}</a>
            {{ end }}
          </div>
          {{- end }}
        </div>

        {{ partial "related.html" . }}
      </main>

      <!-- 右側文章目錄 -->
      {{ if and (gt .WordCount 400) (.TableOfContents) }}
      <aside class="post-toc-sidebar">
        <div class="toc-sticky-container">
          <h3 class="toc-title">本文目錄</h3>
          {{ .TableOfContents }}
        </div>
      </aside>
      {{ end }}
    </div>

    <!-- 留言區（Giscus） -->
    {{ if and (eq .Kind "page") (not .Draft) }}
      <div id="giscus-container" class="mt-16 pt-8 border-t" style="border-color: var(--border-color);">
        {{ partial "giscus.html" . }}
      </div>
    {{ end }}
  </div>
{{ end }}
