+++
title = "äº«å…ƒæ¨¡å¼ï¼šç¯€çœè¨˜æ†¶é«”çš„åˆ©å™¨"
date = 2025-06-12T19:00:00+08:00
dates = ["2025-06-12"]
tags = ["Code", "C#", "DesignPattern"]
prev_post_slug = "0015facade-pattern"
next_post_slug = "0017proxy-pattern"
series = ["DesignPattern"]
weight = 12
+++

å“ˆå›‰å„ä½æœ‹å‹ï¼Œä»Šå¤©æˆ‘å€‘è¦èŠçš„æ˜¯ä¸€å€‹ç‰¹åˆ¥çœè³‡æºçš„è¨­è¨ˆæ¨¡å¼ï¼š**äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰**ã€‚

## ğŸŒŸ äº«å…ƒæ¨¡å¼æ˜¯ä»€éº¼ï¼Ÿ

äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç¨®å¯ä»¥æœ‰æ•ˆç¯€çœè¨˜æ†¶é«”çš„è¨­è¨ˆæ¨¡å¼ï¼Œé€éå…±äº«ç›¸åŒæˆ–ç›¸ä¼¼çš„ç‰©ä»¶ï¼Œé¿å…å»ºç«‹éå¤šé‡è¤‡çš„å°å‹ç‰©ä»¶ã€‚

èˆ‰å€‹ä¾‹å­ï¼šå‡è¨­ä½ åœ¨åšç°¡å ±ï¼Œéœ€è¦å¤§é‡ä½¿ç”¨åŒä¸€å¼µåœ–ç‰‡ï¼Œèˆ‡å…¶åœ¨æ¯å¼µæŠ•å½±ç‰‡è£¡éƒ½é‡æ–°è¤‡è£½ä¸€æ¬¡åœ–ç‰‡ï¼Œä¸å¦‚åªä¿ç•™ä¸€å¼µåŸå§‹åœ–ç‰‡ï¼Œå…¶ä»–æŠ•å½±ç‰‡åªéœ€è¦åƒè€ƒé€™å¼µåœ–ç‰‡å°±å¥½ã€‚é€™æ¨£ä¸€ä¾†å¯ä»¥é™ä½æª”æ¡ˆå¤§å°ï¼Œç¯€çœè¨˜æ†¶é«”ã€‚

---

## ğŸ¤” ä»€éº¼æƒ…å¢ƒé©åˆä½¿ç”¨äº«å…ƒæ¨¡å¼ï¼Ÿ

- ç³»çµ±ä¸­å­˜åœ¨å¤§é‡é‡è¤‡çš„ç‰©ä»¶ã€‚
- ç‰©ä»¶çš„å»ºç«‹èˆ‡éŠ·æ¯€æˆæœ¬éé«˜ï¼Œä¸¦ä¸”é€™äº›ç‰©ä»¶å¤§å¤šé¡ä¼¼ã€‚
- æƒ³ç¯€çœè¨˜æ†¶é«”è³‡æºï¼Œæå‡ç³»çµ±æ•ˆèƒ½ã€‚

---

## ğŸŒ³ C# äº«å…ƒæ¨¡å¼ç¯„ä¾‹

ä»¥ä¸‹ä»¥éŠæˆ²ä¸­å¸¸è¦‹çš„ã€Œæ¨¹æœ¨ã€ç‚ºä¾‹ï¼Œç¤ºç¯„äº«å…ƒæ¨¡å¼çš„å¯¦ä½œæ–¹å¼ã€‚

### ğŸŒ³ äº«å…ƒä»‹é¢èˆ‡å¯¦ä½œ

```csharp
using System;

/// <summary>
/// æ¨¹æœ¨ä»‹é¢
/// </summary>
public interface ITree
{
    /// <summary>
    /// é¡¯ç¤ºæ¨¹æœ¨
    /// </summary>
    /// <param name="x">ä½ç½® X åº§æ¨™</param>
    /// <param name="y">ä½ç½® Y åº§æ¨™</param>
    void Display(int x, int y);
}

/// <summary>
/// å…·é«”äº«å…ƒé¡åˆ¥
/// </summary>
public class Tree : ITree
{
    private readonly string _treeType;

    public Tree(string treeType)
    {
        _treeType = treeType;
        Console.WriteLine($"å»ºç«‹äº†ä¸€å€‹ {treeType} æ¨¹ç‰©ä»¶ã€‚");
    }

    /// <summary>
    /// åœ¨æŒ‡å®šä½ç½®é¡¯ç¤ºæ¨¹æœ¨
    /// </summary>
    public void Display(int x, int y)
    {
        Console.WriteLine($"åœ¨ä½ç½® ({x}, {y}) é¡¯ç¤ºä¸€æ£µ{_treeType}æ¨¹ã€‚");
    }
}
```

### ğŸŒ² äº«å…ƒå·¥å» 

```csharp
using System.Collections.Generic;

/// <summary>
/// äº«å…ƒå·¥å» 
/// </summary>
public class TreeFactory
{
    private readonly Dictionary<string, ITree> _trees = new Dictionary<string, ITree>();

    /// <summary>
    /// å–å¾—æ¨¹æœ¨å¯¦ä¾‹ï¼Œè‹¥ä¸å­˜åœ¨å‰‡å»ºç«‹ä¸¦å¿«å–
    /// </summary>
    public ITree GetTree(string treeType)
    {
        if (!_trees.ContainsKey(treeType))
        {
            _trees[treeType] = new Tree(treeType);
        }
        return _trees[treeType];
    }
}
```

### ğŸš€ å¯¦éš›ä½¿ç”¨ç¯„ä¾‹

```csharp
using System;

class Program
{
    static void Main(string[] args)
    {
        var treeFactory = new TreeFactory();

        // å»ºç«‹å¤šæ£µæ¨¹ï¼Œä½†å…±ç”¨ç›¸åŒç‰©ä»¶
        var oak = treeFactory.GetTree("æ©¡æ¨¹");
        oak.Display(1, 1);
        oak.Display(2, 5);

        var maple = treeFactory.GetTree("æ¥“æ¨¹");
        maple.Display(3, 3);
        maple.Display(4, 8);

        // å†æ¬¡å–å¾—æ©¡æ¨¹ï¼Œæœƒé‡è¤‡ä½¿ç”¨ç¾æœ‰å¯¦ä¾‹
        var anotherOak = treeFactory.GetTree("æ©¡æ¨¹");
        anotherOak.Display(5, 5);
    }
}
```

### ğŸ¯ åŸ·è¡Œçµæœ

```
å»ºç«‹äº†ä¸€å€‹ æ©¡æ¨¹ æ¨¹ç‰©ä»¶ã€‚
åœ¨ä½ç½® (1, 1) é¡¯ç¤ºä¸€æ£µæ©¡æ¨¹æ¨¹ã€‚
åœ¨ä½ç½® (2, 5) é¡¯ç¤ºä¸€æ£µæ©¡æ¨¹æ¨¹ã€‚
å»ºç«‹äº†ä¸€å€‹ æ¥“æ¨¹ æ¨¹ç‰©ä»¶ã€‚
åœ¨ä½ç½® (3, 3) é¡¯ç¤ºä¸€æ£µæ¥“æ¨¹æ¨¹ã€‚
åœ¨ä½ç½® (4, 8) é¡¯ç¤ºä¸€æ£µæ¥“æ¨¹æ¨¹ã€‚
```

---

## âš ï¸ ä½¿ç”¨äº«å…ƒæ¨¡å¼æ³¨æ„äº‹é …

- å„ªé»ï¼šæœ‰æ•ˆæ¸›å°‘è¨˜æ†¶é«”æ¶ˆè€—ï¼Œå°¤å…¶é©ç”¨æ–¼å¤§é‡é‡è¤‡ç‰©ä»¶çš„å ´æ™¯ã€‚
- ç¼ºé»ï¼šç¨‹å¼ç¢¼çµæ§‹ç›¸å°è¤‡é›œï¼Œéœ€è¦è¬¹æ…ç®¡ç†å…±äº«ç‰©ä»¶ç”Ÿå‘½é€±æœŸã€‚

---

## ğŸ‰ çµèª

æ­å–œä½ ï¼ŒåˆæˆåŠŸæŒæ¡äº†äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰ï¼å­¸æœƒé€™å€‹æ¨¡å¼ï¼Œä¾¿èƒ½æ›´æœ‰æ•ˆç‡åœ°ç®¡ç†è³‡æºï¼Œè®“ç³»çµ±æ›´è¼•ç›ˆé«˜æ•ˆã€‚

æŒçºŒé—œæ³¨æˆ‘å€‘çš„è¨­è¨ˆæ¨¡å¼ç³»åˆ—ï¼Œå­¸ç¿’æ›´å¤šå¯¦ç”¨åˆå¥½ç©çš„ç¨‹å¼æŠ€å·§å§ï¼æˆ‘å€‘ä¸‹ç¯‡è¦‹ï½
